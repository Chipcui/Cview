

### CVIEW_TEST ###
#
# This file should be included at the end of your httpd.conf file
#
# It needs to be modified to suit your environment. 
#
# Notes:
# 
# o works only with Apache 1.3 series, not 2.0 series.
# o the code is assumed to be in /data/shared/website/cview
# o you will need to change these references if you install elsewhere.
# o the libs are assumed to be in the standard perl lib dir
# o the PROJECT_NAME must be CVIEW, otherwise it will not work!
#
# Lukas, Oct 4, 2007
#
##################

<VirtualHost *>
    #set an environmental variable which will allow modules which are used by multiple virtual hosts (for instance, CXGN::Page) to find out which virtual host they are running on
    PerlSetEnv PROJECT_NAME CVIEW
    #set an environmental variable for cookies as implemented by CXGN::Page (i suspect this would not be necessary if we were doing cookies correctly --john)
    PerlSetEnv SERVERNAME cview.localhost.localdomain
    #set an environmental variable for basepath, since there may be more than one basepath for similar configurations, if multiple users have similar vhost setups on a machine
    PerlSetEnv BASEPATH /data/local/website/cview
    #are we running as a production server
    PerlSetEnv PRODUCTION_SERVER 0
    #tell perl where to look for modules
	#    PerlSetEnv PERL5LIB  (add more perl libs here and uncomment)
    #the name of the virtual host we are defining
    ServerName cview.localhost.localdomain
    #and any aliases


    #reload all scripts and modules after a restart
    PerlFreshRestart On
    #give warnings
    PerlWarn On
    #do not allow raw user-submitted data to be eval'd or used in system calls
    #PerlTaintCheck On #TRIED TO ADD THIS BUT HAD TO COMMENT THIS OUT BECAUSE LOTS OF OUR SCRIPTS APPARENTLY ALLOW USER-SUBMITTED DATA TO BE EXECUTED AND THIS IS BAD! --john

    #who to email with problems
    ServerAdmin sgn-feedback@sgn.cornell.edu

    #respond to all requests by looking in this directory...
    DocumentRoot /data/local/website/cview/cgi-bin

    #where to write error messages
    ErrorLog /data/local/website/cview/logs/cview-error.log
    CustomLog /data/local/website/logs/cview-access.log combined

    <Directory />
        #allow symlinks
        Options +FollowSymLinks
        #let people come to our website
        Order allow,deny
        Allow from all
    </Directory>

    #when a page is not found or forbidden, go here    
    ErrorDocument 403 /tools/404_submit.pl
    ErrorDocument 404 /tools/404_submit.pl
    #when a script dies, go here. this should always be handled by CXGN::Apache::Registry, but sometimes things break badly. LEAVE THE INITIAL QUOTE IN (unless replacing this with a path to a file)
    ErrorDocument 500 "Internal server error: The server encountered an internal error or misconfiguration and was unable to complete your request. Feel free to contact us at sgn-feedback@sgn.cornell.edu and inform us of the error.

    <Directory /data/local/website/cview/cgi-bin>
        AllowOverride All
        #execute cgi scripts, auto indexing of directories
	Options +ExecCGI +Indexes
        #if only a directory is specified, look for index.pl.
        DirectoryIndex index.pl
        #reuse database connections rather than getting new ones every time a new query is made
        PerlModule Apache::DBI 
        #autoreloading of modules
        PerlModule Apache::StatINC
        PerlInitHandler Apache::StatINC

        #set up perl script parsing
	SetHandler perl-script
        #use this module
        PerlModule CXGN::Apache::Registry
        #send perl scripts to this module for parsing
	PerlHandler CXGN::Apache::Registry
        #send things that look like http headers as http headers
        PerlSendHeader On
        #the output of our perl scripts is to be interpreted as text/html
	AddType text/html .pl
        #the favicon is expected to be right under document root, but don't execute 
        <Files favicon.ico>
            SetHandler none
        </Files>
        #the robots.txt file is expected to be right under document root, but don't execute 
        <Files robots.txt>
            SetHandler none
        </Files>
        #let people come to our website
        Order allow,deny
        Allow from all
    </Directory>

    #documents folder requests go here (not to be confused with apache's document root... sorry if confusing. --john)
    Alias /documents /data/local/website/cview/documents
    #cgi-bin requests go here
    Alias /cgi-bin /data/local/website/cview/cgi-bin

</VirtualHost>
